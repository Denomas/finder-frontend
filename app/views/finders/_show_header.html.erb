<div class="govuk-width-container">
  <% if content_item.show_phase_banner? %>
    <%= render 'govuk_publishing_components/components/phase_banner', phase: content_item.phase, message: sanitize(content_item.phase_message), inverse: inverse %>
  <% end %>

  <% if @breadcrumbs.breadcrumbs %>
    <%= render 'govuk_publishing_components/components/breadcrumbs', {
      breadcrumbs: @breadcrumbs.breadcrumbs,
      inverse: inverse,
      collapse_on_mobile: true
    } %>
  <% else %>
    <%= render 'govuk_publishing_components/components/contextual_breadcrumbs', content_item: content_item.as_hash, inverse: inverse %>
  <% end %>

  <% if content_item.government? %>
    <%= render 'govuk_publishing_components/components/government_navigation', active: content_item.government_content_section %>
  <% end %>

  <div class="govuk-grid-row">
    <div class="govuk-grid-column-two-thirds">
      <% if content_item.all_content_finder? %>
        <% if Rails.configuration.relevancy_prototype %>
          <h1 class="app-c-search-page-heading">How relevant are these results?</h1>
          <p class="govuk-body-l">
            You don't have to enter a score for every result.
          </p>
          <div id="keywords" class="app-patch--search-input-override">
            <%= render "govuk_publishing_components/components/search", {
              size: "large",
              controls: "js-search-results-info",
              id: "finder-keyword-search",
              name: "keywords",
              value: result_set_presenter.user_supplied_keywords,
            } %>
          </div>
          <div id="js-spelling-suggestions" class="spelling-suggestions"
            data-analytics-ecommerce
            data-ecommerce-start-index="1"
            data-list-title="<%= content_item.title %> spelling suggestions"
            data-search-query="<%= result_set_presenter.user_supplied_keywords %>"
            data-track-click-label="Spelling suggestions"
            >
            <%= render 'spelling_suggestion' %>
          </div>
          <details class="govuk-details" data-module="govuk-details">
            <summary class="govuk-details__summary">
              <span class="govuk-details__summary-text">
                How to score results
              </span>
            </summary>
            <div class="govuk-details__text">
                <h4 class="govuk-heading-s">Perfect</h4>
                <p>
                  Based on your search term, the result is completely relevant. This is the best score you can give, and means that the result is exactly right.
                  More than one result can be completely relevant to a search term.
                </p>
                <h4 class="govuk-heading-s">Good</h4>
                <p>
                  The result is not a perfect match, but it is clearly reasonable for it to be in the search results.
                  You are not surprised that the search term brought back such a result.
                </p>
                <h4 class="govuk-heading-s">OK</h4>
                <p>
                  You can see why we returned the result, but it isn't very helpful. For example, a search for
                  “Find my local council” may return a page about how to pay a parking charge to your local council. You can see why it appeared
                  (because it includes a reference to local councils) but it isn’t directly relevant for your search term.
                </p>
                <h4 class="govuk-heading-s">Bad</h4>
                <p>
                  The result has no apparent relationship to your search term. For example a search for “Find my Local Council” that returns a result about
                  booking a driving test.
                </p>
            </div>
          </details>
        <% else %>
          <% label_text = capture do %>
            <h1 class="app-c-search-page-heading">Search<span class="govuk-visually-hidden"> all content</span></h1>
        <% end %>
          <div id="keywords" class="app-patch--search-input-override">
            <%= render "govuk_publishing_components/components/search", {
              size: "large",
              controls: "js-search-results-info",
              id: "finder-keyword-search",
              inline_label: false,
              label: {
                text: label_text,
              },
              name: "keywords",
              value: result_set_presenter.user_supplied_keywords,
            } %>
          </div>
          <div id="js-spelling-suggestions" class="spelling-suggestions"
            data-analytics-ecommerce
            data-ecommerce-start-index="1"
            data-list-title="<%= content_item.title %> spelling suggestions"
            data-search-query="<%= result_set_presenter.user_supplied_keywords %>"
            data-track-click-label="Spelling suggestions"
            >
            <%= render 'spelling_suggestion' %>
          </div>
        <% end %>
      <% elsif topic_finder?(filter_params) %>
        <%= link_to topic_finder_parent(filter_params)['title'], topic_finder_parent(filter_params)['base_path'], class: 'govuk-link topic-finder__taxon-link' %>
        <%= render partial: 'govuk_publishing_components/components/title', locals: {
          title: content_item.title,
          inverse: true,
        } %>
      <% else %>
        <%= render partial: 'govuk_publishing_components/components/title', locals: {
          title: content_item.title,
        } %>
      <% end %>

      <% if page_metadata.any? %>
        <%= render 'govuk_publishing_components/components/metadata', page_metadata %>
      <% end %>
    </div>

    <% if content_item.summary %>
      <div class="govuk-grid-column-two-thirds">
        <div class="metadata-summary ">
          <%= render 'govuk_publishing_components/components/govspeak', content: content_item.summary.html_safe %>
        </div>
      </div>
    <% end %>

    <% if content_item.logo_path %>
      <div class="finder-logo govuk-grid-column-one-third">
        <%= image_tag content_item.logo_path, class: "finder-logo__image" %>
      </div>
    <% end %>

    <% if content_item.related.any? %>
      <div class="related-links govuk-grid-column-one-third">
        <ul class="js-finder-results">
          <% content_item.related.each do |link| %>
            <li class="related-links__item">
              <%= link_to link['title'], link['web_url'], class: "related-links__link" %>
            </li>
          <% end %>
        </ul>
      </div>
    <% end %>
  </div>
</div>
